var gulp=require("gulp"),log=require("gulp-util").log,rename=require("gulp-rename"),jade=require("gulp-jade"),stylus=require("gulp-stylus"),uglify=require("gulp-uglify"),newer=require("gulp-newer"),image=require("gulp-image"),plumber=require("gulp-plumber"),webserver=require("gulp-webserver"),sourcemaps=require("gulp-sourcemaps"),opn=require("opn"),config={watch:"./src/**/*.*",server:{host:"localhost",port:"4000",path:"/dist"},index:{src:"./src/jade/index.jade",destination:"dist/"},devicetemplates:{src:"./src/jade/devicetemplates/index.jade",destination:"dist/devicetemplates"},icontemplates:{src:"./src/jade/icontemplates/index.jade",destination:"dist/icontemplates"},othertemplates:{src:"./src/jade/othertemplates/index.jade",destination:"dist/othertemplates"},css:{src:"./src/styl/app.styl",destination:"dist/css"},js:{src:"./src/js/**",destination:"dist/js"},img:{src:"./src/img/**",destination:"dist/img"},sketchsheets:{src:"./src/sketchsheets/**",destination:"dist/sketchsheets"},fonts:{src:"./src/fonts/**",destination:"dist/fonts"}};gulp.task("webserver",function(){gulp.src(".").pipe(webserver({host:config.server.host,port:config.server.port,livereload:!0,directoryListing:!1}))}),gulp.task("openbrowser",function(){opn("http://"+config.server.host+":"+config.server.port+config.server.path)}),gulp.task("index",function(){var e={};return gulp.src(config.index.src).pipe(plumber()).pipe(jade({pretty:!0,locals:e})).pipe(rename("index.php")).pipe(gulp.dest(config.index.destination))}),gulp.task("devicetemplates",function(){var e={};return gulp.src(config.devicetemplates.src).pipe(plumber()).pipe(jade({pretty:!0,locals:e})).pipe(rename("index.php")).pipe(gulp.dest(config.devicetemplates.destination))}),gulp.task("icontemplates",function(){var e={};return gulp.src(config.icontemplates.src).pipe(plumber()).pipe(jade({pretty:!0,locals:e})).pipe(rename("index.php")).pipe(gulp.dest(config.icontemplates.destination))}),gulp.task("othertemplates",function(){var e={};return gulp.src(config.othertemplates.src).pipe(plumber()).pipe(jade({pretty:!0,locals:e})).pipe(rename("index.php")).pipe(gulp.dest(config.othertemplates.destination))}),gulp.task("stylus",function(){return gulp.src(config.css.src).pipe(plumber()).pipe(stylus({compress:!0})).pipe(rename("style.css")).pipe(gulp.dest(config.css.destination))}),gulp.task("js",function(){return gulp.src(config.js.src).pipe(plumber()).pipe(uglify()).pipe(gulp.dest(config.js.destination))}),gulp.task("img",function(){return gulp.src(config.img.src).pipe(plumber()).pipe(newer(config.img.destination)).pipe(image()).pipe(gulp.dest(config.img.destination))}),gulp.task("sketchsheets",function(){return gulp.src(config.sketchsheets.src).pipe(plumber()).pipe(newer(config.sketchsheets.destination)).pipe(gulp.dest(config.sketchsheets.destination))}),gulp.task("fonts",function(){return gulp.src(config.fonts.src).pipe(plumber()).pipe(gulp.dest(config.fonts.destination))}),gulp.task("watch",function(){log("Watching files"),gulp.watch(config.watch,["build"])}),gulp.task("build",["index","devicetemplates","icontemplates","othertemplates","stylus","js","img","sketchsheets","fonts"]),gulp.task("w",["build","watch"]),gulp.task("default",["build","webserver","watch","openbrowser"]);